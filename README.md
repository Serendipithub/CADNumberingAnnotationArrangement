# 图号标注的线段生成与优化策略

## 已知条件

我们有以下输入数据：

1. **点集**：
   $P = \{p_1, p_2, \dots, p_n\}$，表示引出点的位置。

2. **封闭多边形路径** $M$：
   一个包含所有点 $P$ 的闭合多边形区域。

3. **矩形障碍集合** $B = \{b_1, b_2, \dots, b_m\}$：
   所有矩形均位于多边形 $M$ 内部，用作避障。

4. **驱散线段集合** $L = \{l_1, l_2, \dots, l_k\}$：
   表示应尽量避让的参考线段，用于提升线段布局美观性或清晰度。

## 目标

生成一组**引出线段**，每条线段：

* 起点为点集 $P$ 中某点；
* 终点为多边形 $M$ 的边界上的某点；
* 满足以下几何约束和优化目标。

## 约束条件

每条线段必须满足：

1. **几何约束**：

   * 从引出点出发；
   * 终点位于多边形 $M$ 的边界上；
   * 不穿越多边形边界（只能从内部连出）；
   * 不穿越任意矩形盒子 $B$；
   * 与驱散线段 $L$ 保持一定距离（避免靠近）。

2. **拓扑约束**：

   * 所有线段之间**互不相交**。

3. **优化目标**（在满足约束的前提下）：

   * 若可行，尽量**缩短每条线段的长度**。

## 初版算法方案

1. 在多边形 $M$ 边界上**均匀采样**出候选终点集合；
2. 构建**二分图**：起点集合 $P$ 与边界候选点集合之间，根据可行的直线段连接建立边；
3. 使用**最小堆**维护候选线段，按线段长度排序（短优先）；
4. 采用**贪心算法**：

   * 每轮从堆中选取最短且满足所有约束的线段；
   * 建立引出点与边界点的一一对应关系；
   * 若某些点无法连通，触发**回溯机制**，考虑次优（较长）线段。

## 技术栈说明

* **语言与运行环境**：Python 3.13.5
* **几何运算**：

  * [Shapely](https://shapely.readthedocs.io)：用于表示和处理点、线、多边形及其集合，包括交集、差集等操作；
  * [NumPy](https://numpy.org)：用于高效的数组、矩阵、向量计算；
* **可视化**：

  * [Matplotlib](https://matplotlib.org)：用于绘制几何图形和验证算法效果；
* **数据结构支持**：

  * Python 内置模块 `heapq`：用于实现最大堆以支持贪心搜索。

## 开发环境部署

```sh
# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境
# Windows
.\.venv\Scripts\Activate.ps1
# macOS/Linux
source .venv/bin/activate

# 安装依赖
pip install -r requirements-dev.txt
```
